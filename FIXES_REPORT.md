# Fixes Report

## Root causes found
- Owner aliases were applied inconsistently because there were multiple resolvers (`src/lib/identity.js` and `src/utils/owners.js`) and some UI surfaces used raw team/user strings.
- Filter state existed only in component state, so refresh/back navigation lost selections and some filters compared raw values instead of canonical owner names.
- The transactions pipeline only exported trades from `data/trades-*.json` and ignored Sleeper transactions, so adds/drops never reached `public/data/transactions`.
- App startup preloaded every season/week dataset, risking heavy initial load instead of lazy per-season fetches.

## Changes made (key files/functions)
- `src/lib/identity.js`: added `normalizeOwnerName` (shared resolver) and improved normalization for emails/underscores.
- `src/utils/owners.js`: now reuses `normalizeOwnerName` as the single owner alias resolver.
- `src/pages/MatchupsPage.jsx`, `src/pages/MatchupDetailPage.jsx`, `src/pages/StandingsPage.jsx`, `src/pages/SummaryPage.jsx`, `src/pages/TransactionsPage.jsx`: all owner/team labels now flow through `normalizeOwnerName`.
- `src/pages/MatchupsPage.jsx`, `src/pages/StandingsPage.jsx`, `src/pages/TransactionsPage.jsx`, `src/pages/PlayerPage.jsx`: filters now sync with URL query params and re-filter on change.
- `src/pages/TransactionsPage.jsx`: added transaction type/team filters, counts, and DEV-only diagnostics panel.
- `src/data/loader.js`: `loadTransactions` now annotates payloads with `__meta.path` for diagnostics.
- `src/data/DataContext.jsx`: removed eager full-data preload to keep large datasets lazy-by-season.
- `scripts/pull_sleeper_transactions.py`: fetches Sleeper transactions into `data/transactions-2025.json`.
- `scripts/build_site_weekly_chunks.py`: now merges Sleeper transactions (adds/drops/trades) and avoids emitting raw player IDs in summaries.
- `scripts/verify_frontend_data.mjs`: added a build artifact smoke test for manifest/standings/matchups/transactions coverage.

## Datasets used
- Standings: `public/data/season/{season}.json` generated by `scripts/build_site_weekly_chunks.py`.
- Transactions: `public/data/transactions/{season}.json` generated from `data/trades-*.json` plus Sleeper `data/transactions-{season}.json` when available.

## Checks run (with outputs)
- `npm ci`
  ```
  added 65 packages, and audited 66 packages in 2s
  7 packages are looking for funding
  2 moderate severity vulnerabilities
  ```
- `npm run build`
  ```
  vite v5.4.21 building for production...
  ✓ 58 modules transformed.
  ✓ built in 767ms
  ```
- `npm run preview -- --host --port 4173`
  ```
  Local:   http://localhost:4173/TatnallLegacy/
  Network: http://192.168.1.241:4173/TatnallLegacy/
  ```
- `node scripts/verify_frontend_data.mjs`
  ```
  === FRONTEND DATA VERIFY ===
  Seasons: 11 (max 2025)
  Max week: 18
  Standings rows: 98
  Matchups: 746
  Lineups (rosters): 13780
  Transactions - trades: 88, adds: 592, drops: 532
  ```

Notes: adds/drops now load from the Sleeper transactions export for 2025.
